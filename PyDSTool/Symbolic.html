<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head><title>Symbolic</title>
</head>

<body  lang="en" dir="ltr">


<p>Site navigation:</p>
<ul id="navibar">
<li><a href="./ProjectOverview.html">ProjectOverview</a></li>
<li><a href="./CodeTopics.html">CodeTopics</a></li>
<li><a href="./GettingStarted.html">GettingStarted</a></li>
<li><a href="./Tutorial.html">Tutorial</a></li>
<li><a href="./UserDocumentation.html">UserDocumentation</a></li>
<li><a href="./ToolboxDocumentation.html">ToolboxDocumentation</a></li>
<li><a href="./TechDocumentation.html">TechDocumentation</a></li>
</ul>

<hr>

<h1>Symbolic classes</h1>

<span class="anchor" id="line-1"></span><span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><span class="anchor" id="line-4"></span><span class="anchor" id="line-5"></span><p class="line867"><div class="table-of-contents"><p class="table-of-contents-heading">Contents<ol><li>
<a href="#Overview">Overview</a></li><li>
<a href="#Symbolic_Manipulation">Symbolic Manipulation</a></li><li>
<a href="#Expression_simplification_and_evaluation">Expression simplification and evaluation</a><ol><li>
<a href="#Simplification">Simplification</a></li><li>
<a href="#Evaluation">Evaluation</a></li><li>
<a href="#Advanced_information_about_functions">Advanced information about functions</a></li><li>
<a href="#More_symbolic_substitutions:_name_maps">More symbolic substitutions: name maps</a></li></ol></li><li>
<a href="#Symbolic_versions_of_built-in_math_names">Symbolic versions of built-in math names</a></li><li>
<a href="#Multi-reference_quantities">Multi-reference quantities</a></li><li>
<a href="#More_about_the_QuantSpec_class">More about the QuantSpec class</a></li><li>
<a href="#Vectors_of_symbols">Vectors of symbols</a><ol><li>
<a href="#Vectors_and_multi-reference_Quantities">Vectors and multi-reference Quantities</a></li></ol></li><li>
<a href="#Symbolic_differentiation">Symbolic differentiation</a></li><li>
<a href="#Specification_Types">Specification Types</a></li><li>
<a href="#Creation_of_Python_functions_from_symbolic_expressions">Creation of Python functions from symbolic expressions</a></li><li>
<a href="#Additional_technical_information">Additional technical information</a></li></ol></div> <span class="anchor" id="line-6"></span><span class="anchor" id="line-7"></span><p class="line867">

<h1 id="Overview">1. Overview</h1>
<span class="anchor" id="line-8"></span><span class="anchor" id="line-9"></span><p class="line862">Symbolic math expressions are supported through the <tt>Quantity</tt> and <tt>QuantSpec</tt> classes, defined in <tt>Symbolic.py</tt>. These classes include the ability to perform numerical or symbolic substitution, expression evaluation, and elementary forms of simplification. The simplifications are partially based on the simplifying nature of the Python math expression parser, and partially on legacy code by Pearu Peterson. These symbolic classes are the ultimate "leaves" in the hierarchy of model specification that is supported by the <a href="./ModelSpec.html">ModelSpec</a> classes. <span class="anchor" id="line-10"></span><span class="anchor" id="line-11"></span><p class="line874">In the near future we hope to improve the parsing of PyDSTool symbolic expressions to take full advantage of Python's abstract syntax tree classes, thereby greatly improving the speed of symbolic processing. <span class="anchor" id="line-12"></span><span class="anchor" id="line-13"></span><p class="line862">The rest of this page describes some of the symbolic manipulation features provided. Further examples can be found by running <tt>tests/Symbolic_test.py</tt>, <tt>tests/Symbolic_Diff_test.py</tt> and examining the output. <span class="anchor" id="line-14"></span><span class="anchor" id="line-15"></span><span class="anchor" id="line-16"></span><p class="line867">
<h1 id="Symbolic_Manipulation">2. Symbolic Manipulation</h1>
<span class="anchor" id="line-17"></span><span class="anchor" id="line-18"></span><p class="line862">The essence of symbolic manipulation is the definition of <tt>Quantity</tt> objects. There are three types of Quantity, a <tt>Var</tt> (Variable), <tt>Par</tt> (Parameter), and <tt>Fun</tt> (Function). <span class="anchor" id="line-19"></span><span class="anchor" id="line-20"></span><p class="line874">Let us start by defining a variable named 'v' and a parameter 'p'. 'v' might contain the definition of an auxiliary variable, for instance, in terms of state variables, parameters, or functions. <span class="anchor" id="line-21"></span><span class="anchor" id="line-22"></span><p class="line867"><span class="anchor" id="line-23"></span><span class="anchor" id="line-24"></span><span class="anchor" id="line-25"></span><span class="anchor" id="line-26"></span><span class="anchor" id="line-27"></span><span class="anchor" id="line-28"></span><span class="anchor" id="line-29"></span><span class="anchor" id="line-30"></span><span class="anchor" id="line-31"></span><span class="anchor" id="line-32"></span><span class="anchor" id="line-33"></span><span class="anchor" id="line-1-1"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-bbf1f8a4cf0efdaa0bf927fb0d627ec76ad1a570" lang="en"><span class="line"><span class="anchor" id="line-1-2"></span>&gt;&gt;&gt; <span class="ID">k</span>=<span class="ID">Var</span>(<span class="String">'</span><span class="String">k</span><span class="String">'</span>)   <span class="Comment"># declaration</span></span>
<span class="line"><span class="anchor" id="line-2-1"></span>&gt;&gt;&gt; <span class="ID">v</span>=<span class="ID">Var</span>(<span class="String">'</span><span class="String">(((k-(-10)))/(3+4))</span><span class="String">'</span>, <span class="String">'</span><span class="String">v</span><span class="String">'</span>)</span>
<span class="line"><span class="anchor" id="line-3-1"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">v</span></span>
<span class="line"><span class="anchor" id="line-4-1"></span><span class="ID">v</span></span>
<span class="line"><span class="anchor" id="line-5-1"></span>&gt;&gt;&gt; <span class="ID">apar</span>=<span class="ID">Par</span>(<span class="String">'</span><span class="String">p</span><span class="String">'</span>)</span>
<span class="line"><span class="anchor" id="line-6-1"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">apar</span>, <span class="ID">apar</span>()</span>
<span class="line"><span class="anchor" id="line-7-1"></span><span class="ID">p</span> <span class="ID">p</span></span>
<span class="line"><span class="anchor" id="line-8-1"></span>&gt;&gt;&gt; <span class="ID">apar2</span>=<span class="ID">Par</span>(<span class="String">'</span><span class="String">3.5e-3</span><span class="String">'</span>, <span class="String">'</span><span class="String">p</span><span class="String">'</span>)</span>
<span class="line"><span class="anchor" id="line-9-1"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">apar2</span>, <span class="ID">apar2</span>()</span>
<span class="line"><span class="anchor" id="line-10-1"></span><span class="ID">p</span> <span class="Number">3.5e-3</span></span>
</pre></div></div><span class="anchor" id="line-34"></span><span class="anchor" id="line-35"></span><p class="line862">Notice that the string representation of a Quantity is the Quantity's name. To see what a Quantity is defined to be, we must call it before taking its string representation, as we see for the <tt>Var</tt> and the <tt>Par</tt> objects. When a definition is not given to the Quantity, as for 'apar', its definition is merely its name. This usage is more akin to a <em>declaration</em> of a name than a definition. At this time there is no class method to add the specification directly to a Quantity that has only been declared. (Such a method is not really necessary when the overhead in checking the specification is almost identical to that necessary to re-create the object entirely.) <span class="anchor" id="line-36"></span><span class="anchor" id="line-37"></span><p class="line867"><span class="anchor" id="line-38"></span><span class="anchor" id="line-39"></span><span class="anchor" id="line-40"></span><span class="anchor" id="line-1-3"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-703bdb75585ab77bfedd083292a3ee9b2cbaf5a7" lang="en"><span class="line"><span class="anchor" id="line-1-4"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">v</span>()</span>
<span class="line"><span class="anchor" id="line-2-2"></span>(((<span class="ID">k</span>-(-<span class="Number">10</span>)))/(<span class="Number">3</span>+<span class="Number">4</span>))</span>
</pre></div></div><span class="anchor" id="line-41"></span><span class="anchor" id="line-42"></span><p class="line862">In technical terms, symbols appearing in the definition are 'free', and generally refer to other Quantities. They are not treated as 'local parameters', and therefore this is <em>not</em> the same as defining a function. Compare: <span class="anchor" id="line-43"></span><span class="anchor" id="line-44"></span><p class="line867"><span class="anchor" id="line-45"></span><span class="anchor" id="line-46"></span><span class="anchor" id="line-47"></span><span class="anchor" id="line-48"></span><span class="anchor" id="line-49"></span><span class="anchor" id="line-50"></span><span class="anchor" id="line-51"></span><span class="anchor" id="line-52"></span><span class="anchor" id="line-53"></span><span class="anchor" id="line-54"></span><span class="anchor" id="line-55"></span><span class="anchor" id="line-56"></span><span class="anchor" id="line-1-5"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-33f4367b76acbc64dae3cf986538c864ebdb2814" lang="en"><span class="line"><span class="anchor" id="line-1-6"></span>&gt;&gt;&gt; <span class="ID">v</span>.<span class="ID">freeSymbols</span></span>
<span class="line"><span class="anchor" id="line-2-3"></span>[<span class="String">'</span><span class="String">k</span><span class="String">'</span>]</span>
<span class="line"><span class="anchor" id="line-3-2"></span>&gt;&gt;&gt; <span class="ID">f</span>=<span class="ID">Fun</span>(<span class="String">'</span><span class="String">(((k-(-10)))/(3+4))</span><span class="String">'</span>, [<span class="ID">k</span>], <span class="String">'</span><span class="String">v</span><span class="String">'</span>)</span>
<span class="line"><span class="anchor" id="line-4-2"></span>&gt;&gt;&gt; <span class="ID">f</span>.<span class="ID">freeSymbols</span></span>
<span class="line"><span class="anchor" id="line-5-2"></span>[]</span>
<span class="line"><span class="anchor" id="line-6-2"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">f</span>(<span class="Number">4</span>)</span>
<span class="line"><span class="anchor" id="line-7-2"></span><span class="Number">2.0</span></span>
<span class="line"><span class="anchor" id="line-8-2"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">f</span>(<span class="ID">k</span>)</span>
<span class="line"><span class="anchor" id="line-9-2"></span>(<span class="ID">k</span>+<span class="Number">10</span>)/<span class="Number">7</span></span>
<span class="line"><span class="anchor" id="line-10-2"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">f</span>(<span class="Number">4</span>,<span class="Number">5</span>)</span>
<span class="line"><span class="anchor" id="line-11-1"></span><span class="ID">ValueError</span>: <span class="ID">Invalid</span> <span class="ID">number</span> <span class="ID">of</span> <span class="ID">arguments</span> <span class="ResWord">for</span> <span class="ID">auxiliary</span> <span class="ID">function</span></span>
</pre></div></div><span class="anchor" id="line-57"></span><span class="anchor" id="line-58"></span><p class="line862">Notice that the function assigned to the Python name 'f' was named 'v', and used the same definition string as the <tt>Var</tt> Quantity 'v'. Therefore, calling <tt>f(4)</tt> simply returns the name of the function applied to its arguments. Calling the function with the requisite arguments works as for other Quantities -- it returns the Quantity's definition. The function knows how many arguments it takes, and returns an error if this number is incorrect. The symbol <tt>k</tt> in square brackets in the second argument of the <tt>Fun</tt> initialization specifies the "signature" of the function. <span class="anchor" id="line-59"></span><span class="anchor" id="line-60"></span><span class="anchor" id="line-61"></span><p class="line867">
<h1 id="Expression_simplification_and_evaluation">3. Expression simplification and evaluation</h1>
<span class="anchor" id="line-62"></span><span class="anchor" id="line-63"></span><p class="line867">
<h2 id="Simplification">3.1. Simplification</h2>
<span class="anchor" id="line-64"></span><span class="anchor" id="line-65"></span><p class="line874">The simplification of expressions uses evaluation. <span class="anchor" id="line-66"></span>Algebraic and arithmetical simplification of the definition of a Quantity is done using the object's <tt>simplify</tt> method. <tt>simplify</tt> works <em>in-place</em> on the object, and does not return anything. To return a simplified string without altering the original object, call the object's <tt>eval</tt> method with no arguments. <span class="anchor" id="line-67"></span><span class="anchor" id="line-68"></span><p class="line867"><span class="anchor" id="line-69"></span><span class="anchor" id="line-70"></span><span class="anchor" id="line-71"></span><span class="anchor" id="line-72"></span><span class="anchor" id="line-73"></span><span class="anchor" id="line-74"></span><span class="anchor" id="line-75"></span><span class="anchor" id="line-76"></span><span class="anchor" id="line-77"></span><span class="anchor" id="line-78"></span><span class="anchor" id="line-1-7"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-b65122eb88c081b28396ebe4c24409e6f83596d9" lang="en"><span class="line"><span class="anchor" id="line-1-8"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">v</span>()</span>
<span class="line"><span class="anchor" id="line-2-4"></span>(((<span class="ID">k</span>-(-<span class="Number">10</span>)))/(<span class="Number">3</span>+<span class="Number">4</span>))</span>
<span class="line"><span class="anchor" id="line-3-3"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">v</span>.<span class="ID">eval</span>()</span>
<span class="line"><span class="anchor" id="line-4-3"></span>(<span class="ID">k</span>+<span class="Number">10</span>)/<span class="Number">7</span></span>
<span class="line"><span class="anchor" id="line-5-3"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">v</span>()</span>
<span class="line"><span class="anchor" id="line-6-3"></span>(((<span class="ID">k</span>-(-<span class="Number">10</span>)))/(<span class="Number">3</span>+<span class="Number">4</span>))</span>
<span class="line"><span class="anchor" id="line-7-3"></span>&gt;&gt;&gt; <span class="ID">v</span>.<span class="ID">simplify</span>()</span>
<span class="line"><span class="anchor" id="line-8-3"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">v</span>()</span>
<span class="line"><span class="anchor" id="line-9-3"></span>(<span class="ID">k</span>+<span class="Number">10</span>)/<span class="Number">7</span></span>
</pre></div></div><span class="anchor" id="line-79"></span><span class="anchor" id="line-80"></span><p class="line874">Note that after simplification, the double negative and the extraneous braces have been removed, as well as the arithmetical sub-expression "3+4" simplified to "7". <span class="anchor" id="line-81"></span><span class="anchor" id="line-82"></span><p class="line867">
<h2 id="Evaluation">3.2. Evaluation</h2>
<span class="anchor" id="line-83"></span><span class="anchor" id="line-84"></span><p class="line874">Quantities can also be evaluated at specific values for the free symbols, but care must be taken with functions in terms of the order in which the operations will be performed. Evaluations at non-numeric values for a symbol performs symbolic substitution: <span class="anchor" id="line-85"></span><span class="anchor" id="line-86"></span><p class="line867"><span class="anchor" id="line-87"></span><span class="anchor" id="line-88"></span><span class="anchor" id="line-89"></span><span class="anchor" id="line-90"></span><span class="anchor" id="line-91"></span><span class="anchor" id="line-92"></span><span class="anchor" id="line-93"></span><span class="anchor" id="line-94"></span><span class="anchor" id="line-95"></span><span class="anchor" id="line-96"></span><span class="anchor" id="line-97"></span><span class="anchor" id="line-98"></span><span class="anchor" id="line-99"></span><span class="anchor" id="line-100"></span><span class="anchor" id="line-1-9"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-85b6a8a431d5029f7ab698b93093037a4530295d" lang="en"><span class="line"><span class="anchor" id="line-1-10"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">v</span>.<span class="ID">eval</span>(<span class="ID">k</span>=<span class="Number">4</span>)</span>
<span class="line"><span class="anchor" id="line-2-5"></span><span class="Number">2</span></span>
<span class="line"><span class="anchor" id="line-3-4"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">f</span>(<span class="Number">4</span>)</span>
<span class="line"><span class="anchor" id="line-4-4"></span><span class="ID">v</span>(<span class="Number">4</span>)</span>
<span class="line"><span class="anchor" id="line-5-4"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">f</span>.<span class="ID">eval</span>(<span class="ID">k</span>=<span class="Number">4</span>)</span>
<span class="line"><span class="anchor" id="line-6-4"></span><span class="Number">2</span></span>
<span class="line"><span class="anchor" id="line-7-4"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">f</span>(<span class="ID">k</span>).<span class="ID">eval</span>(<span class="ID">k</span>=<span class="Number">4</span>)</span>
<span class="line"><span class="anchor" id="line-8-4"></span><span class="Number">2</span></span>
<span class="line"><span class="anchor" id="line-9-4"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">f</span>.<span class="ID">eval</span>(<span class="ID">k</span>=<span class="String">'</span><span class="String">kval</span><span class="String">'</span>)</span>
<span class="line"><span class="anchor" id="line-10-3"></span>(<span class="ID">kval</span>+<span class="Number">10</span>)/<span class="Number">7</span></span>
<span class="line"><span class="anchor" id="line-11-2"></span>&gt;&gt;&gt; <span class="ID">kquantvar</span> = <span class="ID">Var</span>(<span class="String">'</span><span class="String">kquant</span><span class="String">'</span>)</span>
<span class="line"><span class="anchor" id="line-12-1"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">f</span>.<span class="ID">eval</span>(<span class="ID">k</span>=<span class="ID">kquantvar</span>)</span>
<span class="line"><span class="anchor" id="line-13-1"></span>(<span class="ID">kquant</span>+<span class="Number">10</span>)/<span class="Number">7</span></span>
</pre></div></div><span class="anchor" id="line-101"></span><span class="anchor" id="line-102"></span><p class="line862">The difference between <tt>f.eval(k=4)</tt> and <tt>f(k).eval(k=4)</tt> is subtle, and is dealt with in the next sub-section. <span class="anchor" id="line-103"></span><span class="anchor" id="line-104"></span><p class="line862">There is another function available for expression substitution, <tt>subs</tt>, that can act more intelligently regarding defined Parameter quantities. The <tt>subs</tt> function can also take a dictionary of assignments. The result of the substitution will always be simplified as much as possible. <span class="anchor" id="line-105"></span><span class="anchor" id="line-106"></span><p class="line867"><span class="anchor" id="line-107"></span><span class="anchor" id="line-108"></span><span class="anchor" id="line-109"></span><span class="anchor" id="line-110"></span><span class="anchor" id="line-111"></span><span class="anchor" id="line-112"></span><span class="anchor" id="line-113"></span><span class="anchor" id="line-114"></span><span class="anchor" id="line-1-11"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-a7ab1ca03cee0daf1daa6fffd9813c142e67bfaa" lang="en"><span class="line"><span class="anchor" id="line-1-12"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">subs</span>(<span class="ID">v</span>(), {<span class="String">'</span><span class="String">k</span><span class="String">'</span>: <span class="Number">4</span>})</span>
<span class="line"><span class="anchor" id="line-2-6"></span><span class="Number">2</span></span>
<span class="line"><span class="anchor" id="line-3-5"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">subs</span>(<span class="ID">v</span>(), {<span class="String">'</span><span class="String">k</span><span class="String">'</span>: <span class="String">'</span><span class="String">4</span><span class="String">'</span>})</span>
<span class="line"><span class="anchor" id="line-4-5"></span><span class="Number">2</span></span>
<span class="line"><span class="anchor" id="line-5-5"></span>&gt;&gt;&gt; <span class="ID">kpar</span>=<span class="ID">Par</span>(<span class="String">'</span><span class="String">4</span><span class="String">'</span>, <span class="String">'</span><span class="String">k</span><span class="String">'</span>)</span>
<span class="line"><span class="anchor" id="line-6-5"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">subs</span>(<span class="ID">v</span>(), <span class="ID">kpar</span>)</span>
<span class="line"><span class="anchor" id="line-7-5"></span><span class="Number">2</span></span>
</pre></div></div><span class="anchor" id="line-115"></span><p class="line874">In the second call, the string "4" has been substituted for the 'k', and the result is the same. In the third, a defined parameter has been provided as a substitution. <span class="anchor" id="line-116"></span><span class="anchor" id="line-117"></span><p class="line862">Remember to use <tt>subs</tt> on the correct object, otherwise you might get unexpected results! <span class="anchor" id="line-118"></span><span class="anchor" id="line-119"></span><p class="line867"><span class="anchor" id="line-120"></span><span class="anchor" id="line-121"></span><span class="anchor" id="line-122"></span><span class="anchor" id="line-123"></span><span class="anchor" id="line-124"></span><span class="anchor" id="line-1-13"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-00dd1f991cc8187c2b999594dd31986a43940465" lang="en"><span class="line"><span class="anchor" id="line-1-14"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">subs</span>(<span class="ID">v</span>, {<span class="String">'</span><span class="String">k</span><span class="String">'</span>: <span class="Number">4</span>})</span>
<span class="line"><span class="anchor" id="line-2-7"></span><span class="ID">v</span></span>
<span class="line"><span class="anchor" id="line-3-6"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">subs</span>(<span class="ID">v</span>, {<span class="String">'</span><span class="String">v</span><span class="String">'</span>: <span class="Number">4</span>})</span>
<span class="line"><span class="anchor" id="line-4-6"></span><span class="Number">4</span></span>
</pre></div></div><span class="anchor" id="line-125"></span><span class="anchor" id="line-126"></span><p class="line862">The first call did nothing because the Quantity assigned to Python name 'v' evaluates to its name, which is also 'v'. This name does not match any of the assignments in the first call to <tt>subs</tt>, but it does in the second. <span class="anchor" id="line-127"></span><span class="anchor" id="line-128"></span><p class="line874">Evaluation of one symbolic expression can perform automatic substitution of values defined by expressions in the local scope: <span class="anchor" id="line-129"></span><span class="anchor" id="line-130"></span><p class="line867"><span class="anchor" id="line-131"></span><span class="anchor" id="line-132"></span><span class="anchor" id="line-133"></span><span class="anchor" id="line-134"></span><span class="anchor" id="line-135"></span><span class="anchor" id="line-136"></span><span class="anchor" id="line-137"></span><span class="anchor" id="line-138"></span><span class="anchor" id="line-139"></span><span class="anchor" id="line-140"></span><span class="anchor" id="line-1-15"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-4df8c3e57a00874a91325ec64e7cd464d4f27b42" lang="en"><span class="line"><span class="anchor" id="line-1-16"></span>&gt;&gt;&gt; <span class="ID">q</span>=<span class="ID">Quantity</span>(<span class="String">'</span><span class="String">xv+1</span><span class="String">'</span>,<span class="String">'</span><span class="String">qv</span><span class="String">'</span>)</span>
<span class="line"><span class="anchor" id="line-2-8"></span>&gt;&gt;&gt; <span class="ID">x</span>=<span class="ID">Quantity</span>(<span class="String">'</span><span class="String">3</span><span class="String">'</span>,<span class="String">'</span><span class="String">xv</span><span class="String">'</span>)</span>
<span class="line"><span class="anchor" id="line-3-7"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">q</span>.<span class="ID">eval</span>()</span>
<span class="line"><span class="anchor" id="line-4-7"></span><span class="Number">4</span></span>
<span class="line"><span class="anchor" id="line-5-6"></span>&gt;&gt;&gt; <span class="ID">a</span>=<span class="ID">x</span>/<span class="ID">q</span></span>
<span class="line"><span class="anchor" id="line-6-6"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">a</span></span>
<span class="line"><span class="anchor" id="line-7-6"></span><span class="ID">xv</span>/<span class="ID">qv</span></span>
<span class="line"><span class="anchor" id="line-8-5"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">a</span>.<span class="ID">eval</span>()</span>
<span class="line"><span class="anchor" id="line-9-5"></span><span class="Number">0.75</span></span>
</pre></div></div><span class="anchor" id="line-141"></span><span class="anchor" id="line-142"></span><p class="line862">If Quant<tt class="backtick"></tt>Specs were used in place of Quantity objects in the above code, <tt>print&nbsp;a</tt> would yield the division in terms of the definitions, namely <tt>3/(xv+1)</tt>. <span class="anchor" id="line-143"></span><span class="anchor" id="line-144"></span><p class="line874">Evaluation with an explicitly-supplied scope dictionary is much faster, if the relevant definitions are known. Equivalently, these definitions can be supplied in the call as a comma-separated sequence. For instance: <span class="anchor" id="line-145"></span><span class="anchor" id="line-146"></span><p class="line867"><span class="anchor" id="line-147"></span><span class="anchor" id="line-148"></span><span class="anchor" id="line-149"></span><span class="anchor" id="line-150"></span><span class="anchor" id="line-151"></span><span class="anchor" id="line-152"></span><span class="anchor" id="line-1-17"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-f817be5b76eea71697696b3f4b919de8d1447c99" lang="en"><span class="line"><span class="anchor" id="line-1-18"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">a</span>.<span class="ID">eval</span>(<span class="ID">xv</span>=<span class="ID">x</span>)</span>
<span class="line"><span class="anchor" id="line-2-9"></span><span class="Number">3</span>/<span class="ID">qv</span></span>
<span class="line"><span class="anchor" id="line-3-8"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">a</span>.<span class="ID">eval</span>(<span class="ID">xv</span>=<span class="ID">x</span>,<span class="ID">qv</span>=<span class="ID">q</span>())  <span class="Comment"># much faster</span></span>
<span class="line"><span class="anchor" id="line-4-8"></span><span class="Number">0.75</span></span>
<span class="line"><span class="anchor" id="line-5-7"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">a</span>.<span class="ID">eval</span>({<span class="String">'</span><span class="String">xv</span><span class="String">'</span>: <span class="ID">x</span>, <span class="String">'</span><span class="String">qv</span><span class="String">'</span>: <span class="ID">q</span>()})  <span class="Comment"># equivalently fast</span></span>
</pre></div></div><span class="anchor" id="line-153"></span><span class="anchor" id="line-154"></span><p class="line874">Note from the above that Quantities only evaluate to their <span class="anchor" id="line-155"></span>definitions if they are <em>called</em> to reduce them to a Quant<tt class="backtick"></tt>Spec object. Otherwise, only the Quantity's "name" will be substituted. <span class="anchor" id="line-156"></span><span class="anchor" id="line-157"></span><p class="line862">This is also the best way to implement <em>partial</em> evaluation, and when substitution overrides are needed: <span class="anchor" id="line-158"></span><span class="anchor" id="line-159"></span><span class="anchor" id="line-160"></span><span class="anchor" id="line-161"></span><span class="anchor" id="line-1-19"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-f9389945eedb60c8a4c128d918d9e788cda71216" lang="en"><span class="line"><span class="anchor" id="line-1-20"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">a</span>.<span class="ID">eval</span>(<span class="ID">xv</span>=<span class="Number">5</span>,<span class="ID">qv</span>=<span class="ID">q</span>())  <span class="Comment"># override xv=3 from local scope</span></span>
<span class="line"><span class="anchor" id="line-2-10"></span><span class="Number">0.833333333333</span></span>
</pre></div></div><span class="anchor" id="line-162"></span><span class="anchor" id="line-163"></span><p class="line862">Notice that the override even applies to the substitution made into <tt>q</tt>, which was defined as <tt>xv+1</tt>, so that the result is 5/6 and not 5/4. <span class="anchor" id="line-164"></span><span class="anchor" id="line-165"></span><span class="anchor" id="line-166"></span><p class="line867">
<h2 id="Advanced_information_about_functions">3.3. Advanced information about functions</h2>
<span class="anchor" id="line-167"></span><span class="anchor" id="line-168"></span><p class="line862">Compare the behaviour of <tt>eval</tt> in the following: <span class="anchor" id="line-169"></span><span class="anchor" id="line-170"></span><p class="line867"><span class="anchor" id="line-171"></span><span class="anchor" id="line-172"></span><span class="anchor" id="line-173"></span><span class="anchor" id="line-174"></span><span class="anchor" id="line-175"></span><span class="anchor" id="line-176"></span><span class="anchor" id="line-177"></span><span class="anchor" id="line-178"></span><span class="anchor" id="line-179"></span><span class="anchor" id="line-180"></span><span class="anchor" id="line-181"></span><span class="anchor" id="line-182"></span><span class="anchor" id="line-183"></span><span class="anchor" id="line-1-21"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-7a35581ba99aca7af4e79725bc5e66364fc38ffb" lang="en"><span class="line"><span class="anchor" id="line-1-22"></span>&gt;&gt;&gt; <span class="ID">a</span>=<span class="ID">Var</span>(<span class="String">'</span><span class="String">a</span><span class="String">'</span>);<span class="ID">b</span>=<span class="ID">Var</span>(<span class="String">'</span><span class="String">b</span><span class="String">'</span>);<span class="ID">c</span>=<span class="ID">Par</span>(<span class="String">'</span><span class="String">c</span><span class="String">'</span>)   <span class="Comment"># declarations</span></span>
<span class="line"><span class="anchor" id="line-2-11"></span>&gt;&gt;&gt; <span class="ID">gfun</span>=<span class="ID">Fun</span>(<span class="ID">a</span>+<span class="ID">b</span>/<span class="ID">c</span>, [<span class="ID">a</span>,<span class="ID">b</span>], <span class="String">'</span><span class="String">g</span><span class="String">'</span>)</span>
<span class="line"><span class="anchor" id="line-3-9"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">gfun</span>.<span class="ID">eval</span>(<span class="ID">a</span>=<span class="Number">4</span>)</span>
<span class="line"><span class="anchor" id="line-4-9"></span><span class="ID">ValueError</span>: <span class="ID">All</span> <span class="ID">function</span> <span class="ID">signature</span> <span class="ID">arguments</span> <span class="ID">are</span> <span class="ID">necessary</span> <span class="ResWord">for</span> <span class="ID">evaluation</span></span>
<span class="line"><span class="anchor" id="line-5-8"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">gfun</span>.<span class="ID">eval</span>(<span class="ID">a</span>=<span class="Number">4</span>,<span class="ID">b</span>=<span class="Number">3</span>)</span>
<span class="line"><span class="anchor" id="line-6-7"></span><span class="Number">4</span>+<span class="Number">3.0</span>/<span class="ID">c</span></span>
<span class="line"><span class="anchor" id="line-7-7"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">gfun</span>.<span class="ID">eval</span>(<span class="ID">a</span>=<span class="Number">4</span>,<span class="ID">b</span>=<span class="Number">3</span>,<span class="ID">c</span>=<span class="Number">3</span>)</span>
<span class="line"><span class="anchor" id="line-8-6"></span><span class="Number">5</span></span>
<span class="line"><span class="anchor" id="line-9-6"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">gfun</span>(<span class="Number">4</span>,<span class="ID">b</span>)</span>
<span class="line"><span class="anchor" id="line-10-4"></span><span class="Number">4</span>+<span class="ID">b</span>/<span class="ID">c</span></span>
<span class="line"><span class="anchor" id="line-11-3"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">gfun</span>(<span class="ID">a</span>,<span class="ID">b</span>).<span class="ID">eval</span>(<span class="ID">a</span>=<span class="Number">4</span>)  <span class="Comment"># equivalent, but too much syntax!</span></span>
<span class="line"><span class="anchor" id="line-12-2"></span><span class="Number">4</span>+<span class="ID">b</span>/<span class="ID">c</span></span>
</pre></div></div><span class="anchor" id="line-184"></span><span class="anchor" id="line-185"></span><p class="line862">Firstly, <tt>gfun</tt> is a function of two arguments, 'a' and 'b', while 'c' is a free variable that must refer to a parameter name if the <tt>Fun</tt> object is to be used in the specification of a right-hand side. When <tt>eval</tt> is called directly on the function, the full function signature must be supplied. But <tt>gfun(a,b)</tt> evaluates to the Quant<tt class="backtick"></tt>Spec object containing the definition of the function. As this is not a function object any of the free names 'a', 'b', or 'c' can be evaluated using <tt>eval</tt>. <span class="anchor" id="line-186"></span><span class="anchor" id="line-187"></span><p class="line874">Note that any evaluations given for names not present in the definition of the object will be ignored. <span class="anchor" id="line-188"></span><span class="anchor" id="line-189"></span><span class="anchor" id="line-190"></span><p class="line867">
<h2 id="More_symbolic_substitutions:_name_maps">3.4. More symbolic substitutions: name maps</h2>
<span class="anchor" id="line-191"></span><span class="anchor" id="line-192"></span><p class="line862">A more efficient way to make multiple symbolic substitutions which are solely textual, i.e. do not involve algebraic simplification, is to use the <tt>mapNames(&lt;name_mapping_dict&gt;)</tt> method of a Quantity. This method takes a dictionary of source -&gt; target names. Matching only occurs on whole symbols (i.e. 'tokens'): a dictionary containing the mapping ('a': 'b') will not map the symbol 'ka_2' to 'kb_2'. The method will also map the Quantity's name if it matches a source name! The method works <em>in-place</em> and does not return anything. In other words, the Quantity will be changed directly if any of its constituent symbols were matched. <span class="anchor" id="line-193"></span><span class="anchor" id="line-194"></span><p class="line867"><span class="anchor" id="line-195"></span><span class="anchor" id="line-196"></span><span class="anchor" id="line-197"></span><span class="anchor" id="line-198"></span><span class="anchor" id="line-199"></span><span class="anchor" id="line-200"></span><span class="anchor" id="line-201"></span><span class="anchor" id="line-202"></span><span class="anchor" id="line-203"></span><span class="anchor" id="line-204"></span><span class="anchor" id="line-1-23"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-97b7e1959580c5e9be8091bd3b5dcbb6fec2b2f7" lang="en"><span class="line"><span class="anchor" id="line-1-24"></span>&gt;&gt;&gt; <span class="ID">v</span>.<span class="ID">mapNames</span>({<span class="String">'</span><span class="String">k</span><span class="String">'</span>: <span class="String">'</span><span class="String">a/b</span><span class="String">'</span>})</span>
<span class="line"><span class="anchor" id="line-2-12"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">v</span>()</span>
<span class="line"><span class="anchor" id="line-3-10"></span>(<span class="ID">a</span>/<span class="ID">b</span>+<span class="Number">10</span>)/<span class="Number">7</span></span>
<span class="line"><span class="anchor" id="line-4-10"></span>&gt;&gt;&gt; <span class="ID">v</span>.<span class="ID">mapNames</span>({<span class="String">'</span><span class="String">a</span><span class="String">'</span>: <span class="String">'</span><span class="String">44</span><span class="String">'</span>, <span class="String">'</span><span class="String">10</span><span class="String">'</span>: <span class="String">'</span><span class="String">-10</span><span class="String">'</span>})</span>
<span class="line"><span class="anchor" id="line-5-9"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">v</span>()</span>
<span class="line"><span class="anchor" id="line-6-8"></span>(<span class="Number">44</span>/<span class="ID">b</span>-<span class="Number">10</span>)/<span class="Number">7</span></span>
<span class="line"><span class="anchor" id="line-7-8"></span>&gt;&gt;&gt; <span class="ID">v</span>.<span class="ID">mapNames</span>({<span class="String">'</span><span class="String">10</span><span class="String">'</span>: <span class="String">'</span><span class="String">20</span><span class="String">'</span>})</span>
<span class="line"><span class="anchor" id="line-8-7"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">v</span>()</span>
<span class="line"><span class="anchor" id="line-9-7"></span>(<span class="Number">44</span>/<span class="ID">b</span>-<span class="Number">20</span>)/<span class="Number">7</span></span>
</pre></div></div><span class="anchor" id="line-205"></span><span class="anchor" id="line-206"></span><span class="anchor" id="line-207"></span><p class="line867">
<h1 id="Symbolic_versions_of_built-in_math_names">4. Symbolic versions of built-in math names</h1>
<span class="anchor" id="line-208"></span><span class="anchor" id="line-209"></span><p class="line862">Symbolic versions of basic math functions and constants are exported by <tt>Symbolic.py</tt> and are also title-cased, in a further parallel to Maple. Calling these functions with regular numeric arguments will presently return the value of the original math function applied to that argument. Calling them with string or Quant<tt class="backtick"></tt>Spec arguments will return a Quant<tt class="backtick"></tt>Spec. <span class="anchor" id="line-210"></span><span class="anchor" id="line-211"></span><p class="line862">The functions supported included the trigonometric, exponential, and logarithmic functions, the absolute value (<tt>Abs</tt>), power (<tt>Pow</tt>), and square root (<tt>Sqrt</tt>) functions. The constants include <tt>E</tt> and <tt>Pi</tt>. <span class="anchor" id="line-212"></span><span class="anchor" id="line-213"></span><span class="anchor" id="line-214"></span><p class="line867">
<h1 id="Multi-reference_quantities">5. Multi-reference quantities</h1>
<span class="anchor" id="line-215"></span><span class="anchor" id="line-216"></span><p class="line874">There is a way to specify a range of related Quantities at once, in a kind of macro. This is useful for repeated definitions, that perhaps are interconnected in a formulaic way. (You may be familiar with this kind of notation in the package XPP.) <span class="anchor" id="line-217"></span><span class="anchor" id="line-218"></span><p class="line867"><span class="anchor" id="line-219"></span><span class="anchor" id="line-220"></span><span class="anchor" id="line-221"></span><span class="anchor" id="line-1-25"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-ba767066b354bb53fe9d47a586698720f5753376" lang="en"><span class="line"><span class="anchor" id="line-1-26"></span>&gt;&gt;&gt; <span class="ID">v</span> = <span class="ID">Var</span>(<span class="String">'</span><span class="String">v</span><span class="String">'</span>); <span class="ID">ipar</span> = <span class="ID">Par</span>(<span class="String">'</span><span class="String">ipar</span><span class="String">'</span>)</span>
<span class="line"><span class="anchor" id="line-2-13"></span>&gt;&gt;&gt; <span class="ID">z</span> = <span class="ID">Var</span>(<span class="String">'</span><span class="String">3+v/((1+i)*ipar)</span><span class="String">'</span>, <span class="String">'</span><span class="String">z[i,0,5]</span><span class="String">'</span>)</span>
</pre></div></div><span class="anchor" id="line-222"></span><span class="anchor" id="line-223"></span><p class="line862">These define six Quantities <tt>z0</tt> to <tt>z5</tt> that are referenced from the Python object <tt>z</tt> as <tt>z[0]</tt> to <tt>z[5]</tt>, e.g. <tt>z[0]&nbsp;==&nbsp;3+v/ipar</tt>. We can see this (with a little help from the <tt>eval</tt> method to simplify): <span class="anchor" id="line-224"></span><span class="anchor" id="line-225"></span><p class="line867"><span class="anchor" id="line-226"></span><span class="anchor" id="line-227"></span><span class="anchor" id="line-228"></span><span class="anchor" id="line-1-27"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-1ceab84bb0f3a7289997feb2a3638500e196c39b" lang="en"><span class="line"><span class="anchor" id="line-1-28"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">z</span>[<span class="Number">0</span>]().<span class="ID">eval</span>()</span>
<span class="line"><span class="anchor" id="line-2-14"></span><span class="ID">x</span>+<span class="ID">v</span>/<span class="ID">ipar</span></span>
</pre></div></div><span class="anchor" id="line-229"></span><span class="anchor" id="line-230"></span><p class="line862">The following example shows how to define a set of ODE right-hand sides that involve a circular connectivity pattern. Notice that the boundary variables <tt>w0</tt> and <tt>w3</tt> have to be defined separately, so that the multi-quantity definition refers to valid Quantities for all index values. <span class="anchor" id="line-231"></span><span class="anchor" id="line-232"></span><p class="line867"><span class="anchor" id="line-233"></span><span class="anchor" id="line-234"></span><span class="anchor" id="line-235"></span><span class="anchor" id="line-236"></span><span class="anchor" id="line-1-29"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-7c583dae9a231036809571827bed7864efda897b" lang="en"><span class="line"><span class="anchor" id="line-1-30"></span>&gt;&gt;&gt; <span class="ID">w0</span> = <span class="ID">Var</span>(<span class="String">'</span><span class="String">w0-2*(w3-w1)</span><span class="String">'</span>, <span class="String">'</span><span class="String">w0</span><span class="String">'</span>, <span class="ID">specType</span>=<span class="String">'</span><span class="String">RHSfuncSpec</span><span class="String">'</span>)</span>
<span class="line"><span class="anchor" id="line-2-15"></span>&gt;&gt;&gt; <span class="ID">w3</span> = <span class="ID">Var</span>(<span class="String">'</span><span class="String">w3-2*(w2-w0)</span><span class="String">'</span>, <span class="String">'</span><span class="String">w3</span><span class="String">'</span>, <span class="ID">specType</span>=<span class="String">'</span><span class="String">RHSfuncSpec</span><span class="String">'</span>)</span>
<span class="line"><span class="anchor" id="line-3-11"></span>&gt;&gt;&gt; <span class="ID">w1and2</span> = <span class="ID">Var</span>(<span class="String">'</span><span class="String">w[i]-2*(w[i-1]-w[i+1])</span><span class="String">'</span>, <span class="String">'</span><span class="String">w[i,1,2]</span><span class="String">'</span>, <span class="ID">specType</span>=<span class="String">'</span><span class="String">RHSfuncSpec</span><span class="String">'</span>)</span>
</pre></div></div><span class="anchor" id="line-237"></span><span class="anchor" id="line-238"></span><p class="line862">Note that the Python dereferencing of a multi-def <tt>z</tt> by <tt>z[2]</tt> actually creates an <em>instance</em> of <tt>z2</tt>. <span class="anchor" id="line-239"></span><span class="anchor" id="line-240"></span><p class="line862">These definitions are also discussed on the page <a href="./ModelSpec.html">ModelSpec</a>. <span class="anchor" id="line-241"></span><span class="anchor" id="line-242"></span><span class="anchor" id="line-243"></span><p class="line867">

<h1 id="More_about_the_QuantSpec_class">6. More about the QuantSpec class</h1>
<span class="anchor" id="line-244"></span><span class="anchor" id="line-245"></span><p class="line862">The Quant<tt class="backtick"></tt>Spec class was mentioned above. It should be considered a pre-Quantity form of raw symbolic expression, in that it has not yet been committed to a life as any particular Quantity sub-type (<tt>Var</tt>, <tt>Par</tt>, or <tt>Fun</tt>). As such, it can be used in different ways in different Quantity definitions, and can be manipulated symbolically in its own right. For the most consistent results, any Quant<tt class="backtick"></tt>Spec results that you want to use again should be defined into a proper <tt>Var</tt> or <tt>Fun</tt> object. <span class="anchor" id="line-246"></span><span class="anchor" id="line-247"></span><p class="line867"><span class="anchor" id="line-248"></span><span class="anchor" id="line-249"></span><span class="anchor" id="line-250"></span><span class="anchor" id="line-251"></span><span class="anchor" id="line-252"></span><span class="anchor" id="line-253"></span><span class="anchor" id="line-254"></span><span class="anchor" id="line-255"></span><span class="anchor" id="line-256"></span><span class="anchor" id="line-257"></span><span class="anchor" id="line-258"></span><span class="anchor" id="line-259"></span><span class="anchor" id="line-260"></span><span class="anchor" id="line-1-31"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-2f38b563f3ff875df2863009ba8bb9bd5d2ceb05" lang="en"><span class="line"><span class="anchor" id="line-1-32"></span>&gt;&gt;&gt; <span class="ID">q</span>=<span class="ID">QuantSpec</span>(<span class="String">'</span><span class="String">q</span><span class="String">'</span>, <span class="String">'</span><span class="String">1+k/2</span><span class="String">'</span>)</span>
<span class="line"><span class="anchor" id="line-2-16"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="Number">2</span> * <span class="ID">q</span></span>
<span class="line"><span class="anchor" id="line-3-12"></span><span class="Number">2</span> * (<span class="Number">1</span>+<span class="ID">k</span>/<span class="Number">2</span>)</span>
<span class="line"><span class="anchor" id="line-4-11"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="Number">1</span> * <span class="ID">q</span></span>
<span class="line"><span class="anchor" id="line-5-10"></span><span class="Number">1</span>+<span class="ID">k</span>/<span class="Number">2</span></span>
<span class="line"><span class="anchor" id="line-6-9"></span>&gt;&gt;&gt; <span class="ResWord">print</span> -<span class="ID">q</span></span>
<span class="line"><span class="anchor" id="line-7-9"></span>-(<span class="Number">1</span>+<span class="ID">k</span>/<span class="Number">2</span>)</span>
<span class="line"><span class="anchor" id="line-8-8"></span>&gt;&gt;&gt; <span class="ID">qm</span> = -<span class="ID">q</span></span>
<span class="line"><span class="anchor" id="line-9-8"></span>&gt;&gt;&gt; <span class="ID">opqm</span> = <span class="Number">1</span> + <span class="ID">qm</span></span>
<span class="line"><span class="anchor" id="line-10-5"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">opqm</span></span>
<span class="line"><span class="anchor" id="line-11-4"></span><span class="Number">1</span>-(<span class="Number">1</span>+<span class="ID">k</span>/<span class="Number">2</span>)</span>
<span class="line"><span class="anchor" id="line-12-3"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">opqm</span>.<span class="ID">eval</span>()</span>
</pre></div></div><span class="anchor" id="line-261"></span><span class="anchor" id="line-262"></span><p class="line862">A major difference to a Quantity object is that the Quant<tt class="backtick"></tt>Spec's name is not an important external part of its nature: only it's definition is important. Therefore, calling <tt>print</tt> on the object always returns its definition. Also, Quant<tt class="backtick"></tt>Specs are not a good place to manipulate <em>vectors</em> of symbols -- these should be converted to full Quantity types. <span class="anchor" id="line-263"></span><span class="anchor" id="line-264"></span><p class="line867">
<h1 id="Vectors_of_symbols">7. Vectors of symbols</h1>
<span class="anchor" id="line-265"></span><span class="anchor" id="line-266"></span><p class="line862">A new feature allows Quantities to define <em>vectors</em> of symbols (of up to rank 2). In practice this simplifies notation significantly, and permits <tt>Fun</tt> functions of several variables that can be symbolically differentiated. Examples of this are in <tt>tests/Symbolic_Diff_test.py</tt> and <tt>vode_withJac_Symbolic_test.py</tt>. <span class="anchor" id="line-267"></span><span class="anchor" id="line-268"></span><p class="line862">Symbolic vectors can be defined for Quant<tt class="backtick"></tt>Specs and Quantities, but are intended to be used in Quantity objects. This is because "array indexing" notation (using square brackets) is only properly supported for Quantities. However, the <tt>fromvector</tt> method turns a vector Quantity <em>or</em> Quant<tt class="backtick"></tt>Spec into a list of non-vector Quant<tt class="backtick"></tt>Spec objects, each defining a component of the vector. It takes an optional integer index argument which selects that component of the vector only. Here's a simple example. <span class="anchor" id="line-269"></span><span class="anchor" id="line-270"></span><p class="line867"><span class="anchor" id="line-271"></span><span class="anchor" id="line-272"></span><span class="anchor" id="line-273"></span><span class="anchor" id="line-274"></span><span class="anchor" id="line-275"></span><span class="anchor" id="line-276"></span><span class="anchor" id="line-277"></span><span class="anchor" id="line-278"></span><span class="anchor" id="line-279"></span><span class="anchor" id="line-280"></span><span class="anchor" id="line-1-33"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-e96d02a202b4e9b04e41cce2156394ee44cba72d" lang="en"><span class="line"><span class="anchor" id="line-1-34"></span>&gt;&gt;&gt; <span class="ID">x</span>=<span class="ID">Var</span>(<span class="String">'</span><span class="String">x</span><span class="String">'</span>);<span class="ID">y</span>=<span class="ID">Var</span>(<span class="String">'</span><span class="String">y</span><span class="String">'</span>)</span>
<span class="line"><span class="anchor" id="line-2-17"></span>&gt;&gt;&gt; <span class="ID">f</span>=<span class="ID">Var</span>([-<span class="Number">3</span>*<span class="ID">Pow</span>((<span class="Number">2</span>*<span class="ID">x</span>+<span class="Number">1</span>),<span class="Number">3</span>)+<span class="Number">2</span>*(<span class="ID">x</span>+<span class="ID">y</span>),-<span class="ID">y</span>/<span class="Number">2</span>], <span class="String">'</span><span class="String">f</span><span class="String">'</span>)</span>
<span class="line"><span class="anchor" id="line-3-13"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">f</span>[<span class="Number">1</span>]   <span class="Comment"># only works if f is a Quantity type</span></span>
<span class="line"><span class="anchor" id="line-4-12"></span>-<span class="ID">y</span>/<span class="Number">2</span></span>
<span class="line"><span class="anchor" id="line-5-11"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">f</span>.<span class="ID">fromvector</span>(<span class="Number">1</span>)   <span class="Comment"># equivalent, safe for both types</span></span>
<span class="line"><span class="anchor" id="line-6-10"></span>-<span class="ID">y</span>/<span class="Number">2</span></span>
<span class="line"><span class="anchor" id="line-7-10"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ResWord">isinstance</span>(<span class="ID">df</span>.<span class="ID">fromvector</span>(), <span class="ResWord">list</span>)</span>
<span class="line"><span class="anchor" id="line-8-9"></span><span class="ResWord">True</span></span>
<span class="line"><span class="anchor" id="line-9-9"></span>&gt;&gt;&gt; </span>
</pre></div></div><span class="anchor" id="line-281"></span><span class="anchor" id="line-282"></span><p class="line862">Note that we could have used the infix <tt>**</tt> notation for powers instead of the function <tt>Pow</tt>. <span class="anchor" id="line-283"></span><span class="anchor" id="line-284"></span><p class="line874">Other utility methods are provided to reduce Quantities whose definitions are entirely numeric to floating point numbers or arrays of such. Here's an example of Jacobian evaluation. <span class="anchor" id="line-285"></span><span class="anchor" id="line-286"></span><p class="line867"><span class="anchor" id="line-287"></span><span class="anchor" id="line-288"></span><span class="anchor" id="line-289"></span><span class="anchor" id="line-290"></span><span class="anchor" id="line-291"></span><span class="anchor" id="line-292"></span><span class="anchor" id="line-293"></span><span class="anchor" id="line-294"></span><span class="anchor" id="line-295"></span><span class="anchor" id="line-296"></span><span class="anchor" id="line-297"></span><span class="anchor" id="line-298"></span><span class="anchor" id="line-299"></span><span class="anchor" id="line-300"></span><span class="anchor" id="line-1-35"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-0f73484f190b8f623c949371cd09c8be193d8a08" lang="en"><span class="line"><span class="anchor" id="line-1-36"></span>&gt;&gt;&gt; <span class="ID">df</span> = <span class="ID">Diff</span>(<span class="ID">f</span>, [<span class="ID">x</span>,<span class="ID">y</span>])</span>
<span class="line"><span class="anchor" id="line-2-18"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">df</span></span>
<span class="line"><span class="anchor" id="line-3-14"></span>[[((-<span class="Number">3</span>)*<span class="Number">6</span>*<span class="ID">Pow</span>((<span class="Number">2</span>*<span class="ID">x</span>+<span class="Number">1</span>),<span class="Number">2</span>)+<span class="Number">2</span>),<span class="Number">2</span>],[<span class="Number">0</span>,-<span class="Number">0.5</span>]]</span>
<span class="line"><span class="anchor" id="line-4-13"></span>&gt;&gt;&gt; <span class="ID">dfe</span> = <span class="ID">df</span>.<span class="ID">eval</span>(<span class="ID">x</span>=<span class="Number">3</span>,<span class="ID">y</span>=<span class="Number">10</span>)</span>
<span class="line"><span class="anchor" id="line-5-12"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">dfe</span>   <span class="Comment"># this is a QuantSpec representation of the array</span></span>
<span class="line"><span class="anchor" id="line-6-11"></span>[[-<span class="Number">880</span>,<span class="Number">2</span>],[<span class="Number">0</span>,-<span class="Number">0.5</span>]]</span>
<span class="line"><span class="anchor" id="line-7-11"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">dfe</span>.<span class="ID">isvector</span>()</span>
<span class="line"><span class="anchor" id="line-8-10"></span><span class="ResWord">True</span></span>
<span class="line"><span class="anchor" id="line-9-10"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">dfe</span>.<span class="ID">dim</span></span>
<span class="line"><span class="anchor" id="line-10-6"></span><span class="Number">2</span></span>
<span class="line"><span class="anchor" id="line-11-5"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">dfe</span>.<span class="ID">tonumeric</span>()   <span class="Comment"># this is an array</span></span>
<span class="line"><span class="anchor" id="line-12-4"></span>[[ -<span class="Number">8.80000000e+02</span>   <span class="Number">2.00000000e+00</span>]</span>
<span class="line"><span class="anchor" id="line-13-2"></span> [  <span class="Number">0.00000000e+00</span>  -<span class="Number">5.00000000e-01</span>]]</span>
</pre></div></div><span class="anchor" id="line-301"></span><span class="anchor" id="line-302"></span><p class="line874">Here's a demonstration that these methods commute in the expected way. <span class="anchor" id="line-303"></span><span class="anchor" id="line-304"></span><p class="line867"><span class="anchor" id="line-305"></span><span class="anchor" id="line-306"></span><span class="anchor" id="line-307"></span><span class="anchor" id="line-308"></span><span class="anchor" id="line-309"></span><span class="anchor" id="line-1-37"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-47d94ee6e401767d542e2c57ffbefd4b1fe69b27" lang="en"><span class="line"><span class="anchor" id="line-1-38"></span>&gt;&gt;&gt; <span class="ID">a</span> = <span class="ID">df</span>.<span class="ID">fromvector</span>(<span class="Number">0</span>).<span class="ID">eval</span>(<span class="ID">x</span>=<span class="Number">3</span>,<span class="ID">y</span>=<span class="Number">10</span>).<span class="ID">tonumeric</span>()</span>
<span class="line"><span class="anchor" id="line-2-19"></span>&gt;&gt;&gt; <span class="ID">b</span> = <span class="ID">df</span>.<span class="ID">eval</span>(<span class="ID">x</span>=<span class="Number">3</span>,<span class="ID">y</span>=<span class="Number">10</span>).<span class="ID">tonumeric</span>()[<span class="Number">0</span>]</span>
<span class="line"><span class="anchor" id="line-3-15"></span>&gt;&gt;&gt; <span class="ResWord">print</span> <span class="ID">a</span>[<span class="Number">0</span>]==<span class="ID">b</span>[<span class="Number">0</span>] <span class="ResWord">and</span> <span class="ID">a</span>[<span class="Number">1</span>]==<span class="ID">b</span>[<span class="Number">1</span>]</span>
<span class="line"><span class="anchor" id="line-4-14"></span><span class="ResWord">True</span></span>
</pre></div></div><span class="anchor" id="line-310"></span><span class="anchor" id="line-311"></span><span class="anchor" id="line-312"></span><p class="line867">
<h2 id="Vectors_and_multi-reference_Quantities">7.1. Vectors and multi-reference Quantities</h2>
<span class="anchor" id="line-313"></span><span class="anchor" id="line-314"></span><p class="line862">You may have noticed that Quantities defining multiple variables using the square bracket notation have a clash of notation with vectors. This is easily disambiguated because the Quantity object cannot be both a multiple quantity reference and a vector. It may be vector that <em>contains</em> multiple quantity references, but indexing such a Quantity will return its vector components. <span class="anchor" id="line-315"></span><span class="anchor" id="line-316"></span><p class="line874">Some features of multiple quantity definitions are not yet fully compatible with symbolic differentiation. <span class="anchor" id="line-317"></span><span class="anchor" id="line-318"></span><span class="anchor" id="line-319"></span><p class="line867">


<h1 id="Symbolic_differentiation">8. Symbolic differentiation</h1>
<span class="anchor" id="line-320"></span><span class="anchor" id="line-321"></span><p class="line862">Symbolic differentiation of mathematical expressions involving common mathematical functions is supported through the function <tt>Diff</tt>. Most of the contents of this file were originally written by Pearu Peterson as part of a separate project, and later adapted by Ryan Gutenkunst. As Pearu and Ryan appear to have abandoned this version of his code in favour of different (and ultimately more efficient approaches that are less compatible with the PyDSTool classes), I have taken the liberty to adapt the code and include it with PyDSTool. For instance, I fixed a few residual bugs and limitations, and extended the code to work with the <tt>Quantity</tt> and <tt>QuantSpec</tt> classes. <span class="anchor" id="line-322"></span><span class="anchor" id="line-323"></span><p class="line862">The <tt>Diff</tt> function is meant to be a symbolic counterpart to the numerical derivative function <tt>diff</tt>, implemented in <tt>common.py</tt>, in the spirit of the <a class="http" href="http://www.maplesoft.com/">Maple</a> symbolic engine. <span class="anchor" id="line-324"></span><span class="anchor" id="line-325"></span><p class="line862">For many examples see the script <tt>PyDSTool/tests/Symbolic_Diff_test.py</tt>. <span class="anchor" id="line-326"></span><span class="anchor" id="line-327"></span><span class="anchor" id="line-328"></span><p class="line867">


<h1 id="Specification_Types">9. Specification Types</h1>
<span class="anchor" id="line-329"></span><span class="anchor" id="line-330"></span><p class="line862">There are three specification sub-types of both Quantity and Quant<tt class="backtick"></tt>Spec objects, determined by the 'spec<tt class="backtick"></tt>Type' argument at initialization. These types are 'RH<tt class="backtick"></tt>Sfunc<tt class="backtick"></tt>Spec' (the named Quantity is defined as a right-hand side for differential or difference equation), 'Exp<tt class="backtick"></tt>Func<tt class="backtick"></tt>Spec' (the named Quantity is defined explicitly by the expression, such as for an auxiliary variable), and 'Imp<tt class="backtick"></tt>Func<tt class="backtick"></tt>Spec' (defined implicitly by the expression). The default is 'Exp<tt class="backtick"></tt>Func<tt class="backtick"></tt>Spec'. This type does not allow the Quantity's name to appear in the defining expression, whereas the other two types do allow this. <span class="anchor" id="line-331"></span><span class="anchor" id="line-332"></span><p class="line862">These type strings are used by the Model<tt class="backtick"></tt>Constructor class to automatically determine how to treat each definition in a 'flattened' <a href="./ModelSpec.html">ModelSpec</a> specification dictionary, and allows it to verify whether the types are compatible with the target Generator in which the specification will be instantiated. For instance, 'Imp<tt class="backtick"></tt>Func<tt class="backtick"></tt>Spec' definition types cannot be supplied to an <tt>ExplicitFnGen</tt> generator class. <span class="anchor" id="line-333"></span><span class="anchor" id="line-334"></span><span class="anchor" id="line-335"></span><p class="line867">
<h1 id="Creation_of_Python_functions_from_symbolic_expressions">10. Creation of Python functions from symbolic expressions</h1>
<span class="anchor" id="line-336"></span><span class="anchor" id="line-337"></span><p class="line862">Symbolic expressions can be turned into Python functions using the <tt>expr2fun</tt> utility. The "free names" of an expression can either be numerically substituted from a supplied name -&gt; value dictionary or left to become formal arguments to the function. <span class="anchor" id="line-338"></span><span class="anchor" id="line-339"></span><p class="line862">This utility can be handy to graph auxiliary functions from their abstract specifications (e.g., see <tt>/tests/CIN.py</tt>). <span class="anchor" id="line-340"></span><span class="anchor" id="line-341"></span><span class="anchor" id="line-342"></span><p class="line867">
<h1 id="Additional_technical_information">11. Additional technical information</h1>
<span class="anchor" id="line-343"></span><span class="anchor" id="line-344"></span><p class="line862">Both Quantity and Quant<tt class="backtick"></tt>Spec objects have a <tt>usedSymbols</tt> attribute that shows which alphanumeric symbols were used in the object's <em>definition</em> (not including its name). <span class="anchor" id="line-345"></span><span class="anchor" id="line-346"></span><p class="line874">When defining a Quantity, additional information can be provided, such as the valid domain of the variable/parameter/function values. The domain defaults to the floating-point continuous domain [-INF,INF]. <span class="anchor" id="line-347"></span>

<span class="anchor" id="bottom"></span></div>

<div id="pagebottom"></div>
</div>
</body>
</html>

